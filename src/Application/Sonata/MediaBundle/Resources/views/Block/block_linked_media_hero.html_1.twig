{#

This file is part of the Sonata package.

(c) Thomas Rabaix <thomas.rabaix@sonata-project.org>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}
{% extends 'SonataBlockBundle:Block:block_base.html.twig' %}

{% block block %}

    <div id="panel1" class="container"><!-- first panel -->

        <div class="row">
            <div class="span12 clearfix">
                <div id="carousel1" class="carousel slide">
                    <div class="carousel-inner">
                        <div class="item active">
                            <div class="hero-img">
                            {% if sonata_page.isEditor or app.security and app.security.isGranted('ROLE_PREVIOUS_ADMIN') %}
                                {% if app.environment == 'prod' %}
                                    <a href="/admin/sonata/media/media/list?uniqid=s51b41b760fd35&amp;code=sonata.media.admin.media&amp;pcode=sonata.page.admin.block&amp;puniqid=s51b41b76033d5" onclick="return start_field_dialog_form_list_s51b41b76033d5_settings_mediaId(this);" class="btn btn-mini" blockid="{{ block.id }}" code="sonata.media.admin.media" title="List" style="margin-left:10px; z-index: 1023; position: relative"><i class="icon-list"></i>
                                        Select Media
                                    </a>
                                    <a href="/admin/sonata/media/media/create?uniqid=s51b41b760fd35&amp;code=sonata.media.admin.media&amp;pcode=sonata.page.admin.block&amp;puniqid=s51b41b76033d5" onclick="return start_field_dialog_form_list_s51b41b76033d5_settings_mediaId(this);" class="btn btn-mini" blockid="{{ block.id }}" code="sonata.media.admin.media" title="List" style="margin-left:10px; z-index: 1023; position: relative"><i class="icon-list"></i>
                                        Add Media
                                    </a>
                                {% else %}
                                    <a href="/app_dev.php/admin/sonata/media/media/list?uniqid=s51b41b760fd35&amp;code=sonata.media.admin.media&amp;pcode=sonata.page.admin.block&amp;puniqid=s51b41b76033d5" onclick="return start_field_dialog_form_list_s51b41b76033d5_settings_mediaId(this);" class="btn btn-mini" blockid="{{ block.id }}" code="sonata.media.admin.media" title="List" style="margin-left:10px; z-index: 1023; position: relative"><i class="icon-list"></i>
                                        Select Media
                                    </a>
                                    <a href="/app_dev.php/admin/sonata/media/media/create?uniqid=s51b41b760fd35&amp;code=sonata.media.admin.media&amp;pcode=sonata.page.admin.block&amp;puniqid=s51b41b76033d5" onclick="return start_field_dialog_form_list_s51b41b76033d5_settings_mediaId(this);" class="btn btn-mini" blockid="{{ block.id }}" code="sonata.media.admin.media" title="List" style="margin-left:10px; z-index: 1023; position: relative"><i class="icon-list"></i>
                                        Add Media
                                    </a>
                                {% endif %}
                                <!--<a class="btn-primary btn" id="clickBtn" href="/app_dev.php/admin/sonata/media/media/list?uniqid=s51b41b760fd19&code=sonata.media.admin.media&pcode=sonata.page.admin.block&puniqid=s51b41b76033d8" data-toggle="modal" data-target="#myModal_{#{ block.id }#}">Edit</a> -->

                                <div class="container sonata-ba-modal sonata-ba-modal-edit-one-to-one ui-dialog-content ui-widget-content" style="width: auto; min-height: 104px; height: auto; display: none; z-index:9999" id="field_dialog_s51b41b76033d5_settings_mediaId" scrolltop="0" scrollleft="0">
                                </div>
                                <a href="#MediaSettings_{{ block.id }}" role="button" class="btn btn-mini" data-toggle="modal" style="margin-left:10px; z-index: 1023; position: relative">Settings</a>

                                <div id="MediaSettings_{{ block.id }}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="z-index: 10000">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                                        <h3 id="myModalLabel">Edit Settings</h3>
                                    </div>

                                    <div class="modal-body">

                                        <input id="block_id" type="hidden" value="{{ block.id }}">
                                        <div class="control-group">
                                            <label class="control-label" for="url">Image Link Url</label>
                                            <div class="controls">
                                                <input id="media_settings_{{ block.id }}_url" name="media_settings_{{ block.id }}_url" class="input-medium" type="text" value="{{ settings.url }}">
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="overlay_title">Overlay Title</label>
                                            <div class="controls">
                                                <input id="media_settings_{{ block.id }}_overlay_title" name="media_settings_{{ block.id }}_overlay_title" class="input-medium" type="text" value="{{ settings.overlay_title }}">
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="overlay_desc">Overlay Description</label>
                                            <div class="controls">
                                                <input id="media_settings_{{ block.id }}_desc" name="media_settings_{{ block.id }}_desc" type="text" value="{{ settings.desc }}">
                                            </div>
                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                                        <button class="btn" data-dismiss="modal" onclick="save_media_settings_{{ block.id }}()" aria-hidden="true">Save Changes</button>
                                    </div>
                                </div>

                            {% endif %}

                                    {% if media %}
                                        {% media media, settings.format %}
                                    {% else %}
                                        {% if sonata_page.isEditor or app.security and app.security.isGranted('ROLE_PREVIOUS_ADMIN') %}
                                            <img title="" src="/uploads/default.jpeg" width="820" height="615">
                                        {% endif %}
                                    {% endif %}
                                </div>
                            <div class="container">
                                <div class="carousel-caption">
                                    <h1>{{ settings.overlay_title }}</h1>
                                    <p class="lead">{{ settings.desc }}</p>
                                    <a href="{% if settings.url %}{{ settings.url }}{% else %}{{ "#" }}{% endif %}" class="read-more">read more</a>
                                    {#<a href="#" class="read-more">read more</a>#}
                                    <!-- NL form -->
                                    <form id="nl-form" class="nl-form" action="{{ path('tne_operator_listing_search') }}" method="GET">
                                        <span>I'd like</span>
                                        <select name="type">
                                            <option value="0" selected>Accommodation</option>
                                            <option value="1">Events</option>
                                            <option value="2">Attractions</option>
                                        </select>
                                        <br class="hidden-phone hidden-tablet" /><span>for</span>
                                        <select name="pax">
                                            <option value="1 Adult" selected>1 Adult</option>
                                            <option value="2 Adults">2 Adults</option>
                                            <option value="3 Adults">3 Adults</option>
                                            <option value="4 Adults">4 Adults</option>
                                            <option value="2 Adult, 1 Child">A Family</option>
                                        </select>
                                        <br class="" /><span>on the</span>
                                        <select name="startDate">
                                            <option value="1" selected>5th Jun</option><!-- this needs to become a datePicker but I think it's best to do post-integration as already exists in operator search -->
                                        </select>
                                        <input type="hidden" name="endDate" value="" />
                                        <span class="noClear">for</span>
                                        <select name="nights">
                                            <option value="1" selected>1 night</option>
                                            <option value="2">2 nights</option>
                                            <option value="3">3 nights</option>
                                        </select>
                                        <div class="nl-submit-wrap">
                                            <input class="nl-submit" value="see what's on offer" type="submit" />
                                        </div>
                                        <div class="nl-overlay"></div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script type="text/javascript">
        function save_media_settings_{{ block.id }}(){
            $.ajax({
                url: baseurl+'/admin/sonata/page/page/storeMediaSettings',
                type: "GET",
                data: {
                    'url': $("#media_settings_{{block.id}}_url").val(),
                    'overlay_title': $("#media_settings_{{block.id}}_overlay_title").val(),
                    'desc': $("#media_settings_{{block.id}}_desc").val(),
                    'blockId': {{block.id}}
                },
                success: function(data) {
                    location.reload();
                }
            });
            return false;
        }
    </script>
{% endblock %}